<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns="http://www.springframework.org/schema/security"
             xmlns:context="http://www.springframework.org/schema/context"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
             http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/security
      http://www.springframework.org/schema/security/spring-security.xsd
      http://www.springframework.org/schema/context
      http://www.springframework.org/schema/context/spring-context.xsd">

    <context:property-placeholder
            location="
         classpath:application.properties" />

    <http request-matcher="regex" auto-config="true" use-expressions="true">
        <!-- web-страницы -->

        <!-- Rest-сервис -->

        <form-login
                authentication-success-handler-ref="authSuccessHandler"
                login-page="/login"
                authentication-failure-url="/login?login_error=1"
                username-parameter="login" password-parameter="password"
                authentication-success-forward-url="/"/>
        <csrf disabled="true"/>
    </http>

    <beans:bean id="authSuccessHandler" class="com.company.service.AuthSuccessHandler"/>

    <beans:bean id="accountService" class="com.company.service.MultiloginAccountService">
        <beans:property name="accountDAO" ref="accountDAO"/>
        <beans:property name="accIdConverter" ref="accountIdentifyConverter"/>
    </beans:bean>

    <authentication-manager alias="authenticationManager">
        <authentication-provider user-service-ref="accountService">
            <password-encoder hash="sha"/>
        </authentication-provider>
    </authentication-manager>

    <beans:bean id="verificationCodeGenerator" class="com.company.service.util.DigitCodeGenerator">
        <beans:property name="length" value="${security.verificationCode.length}"/>
    </beans:bean>

    <beans:bean id="connectionFactoryLocator"
                class="org.springframework.social.connect.support.ConnectionFactoryRegistry">
        <beans:property name="connectionFactories">
            <beans:list>
                <beans:bean class="org.springframework.social.facebook.connect.FacebookConnectionFactory">
                    <beans:constructor-arg value="${social.facebook.appId}"/>
                    <beans:constructor-arg value="${social.facebook.appSecret}"/>
                </beans:bean>
            </beans:list>
        </beans:property>
    </beans:bean>
</beans:beans>